<html>
 <head>
  <!--需要导入jsUnitCore.js文件-->
  <script language="JavaScript" src="../../jsunit/app/jsUnitCore.js"></script>
  
  <!--=============================-->
	<!-- Copy this part to your app. -->
	<!-- START                       -->
	<!--=============================-->
	<!-- libs -->
	<!--[if IE]><script type="text/javascript" src="../../js/excanvas.js"></script><![endif]-->
	<script src="../../js/protoclass.js"></script>
	<script src="../../js/jquery-1.6.min.js"></script>

	<!-- box2djs -->
	<script src='../../js/box2d/common/b2Settings.js'></script>
	<script src='../../js/box2d/common/math/b2Vec2.js'></script>
	<script src='../../js/box2d/common/math/b2Mat22.js'></script>
	<script src='../../js/box2d/common/math/b2Math.js'></script>
	<script src='../../js/box2d/collision/b2AABB.js'></script>
	<script src='../../js/box2d/collision/b2Bound.js'></script>
	<script src='../../js/box2d/collision/b2BoundValues.js'></script>
	<script src='../../js/box2d/collision/b2Pair.js'></script>
	<script src='../../js/box2d/collision/b2PairCallback.js'></script>
	<script src='../../js/box2d/collision/b2BufferedPair.js'></script>
	<script src='../../js/box2d/collision/b2PairManager.js'></script>
	<script src='../../js/box2d/collision/b2BroadPhase.js'></script>
	<script src='../../js/box2d/collision/b2Collision.js'></script>
	<script src='../../js/box2d/collision/Features.js'></script>
	<script src='../../js/box2d/collision/b2ContactID.js'></script>
	<script src='../../js/box2d/collision/b2ContactPoint.js'></script>
	<script src='../../js/box2d/collision/b2Distance.js'></script>
	<script src='../../js/box2d/collision/b2Manifold.js'></script>
	<script src='../../js/box2d/collision/b2OBB.js'></script>
	<script src='../../js/box2d/collision/b2Proxy.js'></script>
	<script src='../../js/box2d/collision/ClipVertex.js'></script>
	<script src='../../js/box2d/collision/shapes/b2Shape.js'></script>
	<script src='../../js/box2d/collision/shapes/b2ShapeDef.js'></script>
	<script src='../../js/box2d/collision/shapes/b2BoxDef.js'></script>
	<script src='../../js/box2d/collision/shapes/b2CircleDef.js'></script>
	<script src='../../js/box2d/collision/shapes/b2CircleShape.js'></script>
	<script src='../../js/box2d/collision/shapes/b2MassData.js'></script>
	<script src='../../js/box2d/collision/shapes/b2PolyDef.js'></script>
	<script src='../../js/box2d/collision/shapes/b2PolyShape.js'></script>
	<script src='../../js/box2d/dynamics/b2Body.js'></script>
	<script src='../../js/box2d/dynamics/b2BodyDef.js'></script>
	<script src='../../js/box2d/dynamics/b2CollisionFilter.js'></script>
	<script src='../../js/box2d/dynamics/b2Island.js'></script>
	<script src='../../js/box2d/dynamics/b2TimeStep.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2ContactNode.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2Contact.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2ContactConstraint.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2ContactConstraintPoint.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2ContactRegister.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2ContactSolver.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2CircleContact.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2Conservative.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2NullContact.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2PolyAndCircleContact.js'></script>
	<script src='../../js/box2d/dynamics/contacts/b2PolyContact.js'></script>
	<script src='../../js/box2d/dynamics/b2ContactManager.js'></script>
	<script src='../../js/box2d/dynamics/b2World.js'></script>
	<script src='../../js/box2d/dynamics/b2WorldListener.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2JointNode.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2Joint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2JointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2DistanceJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2DistanceJointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2Jacobian.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2GearJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2GearJointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2MouseJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2MouseJointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2PrismaticJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2PrismaticJointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2PulleyJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2PulleyJointDef.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2RevoluteJoint.js'></script>
	<script src='../../js/box2d/dynamics/joints/b2RevoluteJointDef.js'></script>
	<!--=============================-->
	<!-- Copy this part to your app. -->
	<!-- END                         -->
	<!--=============================-->
	
	<script language="JavaScript" src="../../js/create.js"></script>
  <script language="JavaScript" src="../../js/control.js"></script>
  <script language="JavaScript" >
  
  var bikegame = {
			//当前显示状态
			stateStart: 1,
			statePlaying: 2,
		    statelLevelResult:3,
			stateGameover:4,
		    currentState: 0,

		    compeltedLevel:0,
			currentLevel: 0, //记录当前游戏的关卡
		    currentSpeed: 0, //瞬时速度
		    speedMax:400,    //设置允许的最高速度，防止游戏速度过高
		    timeCount: 0,    //已用时间，单位1/60 s

		    levelScore:0, //当前关卡获得的分数
		    totalScore:0 //总共获得的分数，每次关卡结束后计算
		}

		var canvas;
		var ctx;
		var canvasWidth;
		var canvasHeight;

		//设置多关卡的参数
		bikegame.levels = new Array();
		bikegame.levels[0]=[
		{type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0, fuel:30},
		{type:"ground", x:250, y:270, width:250, height:25, rotation:0},
		{type:"ground", x:500, y:250, width:65, height:15, rotation:-10},
		{type:"ground", x:600, y:225, width:80, height:15, rotation:-20},
		{type:"ground", x:1100, y:250, width:100, height:15, rotation:0},
		{type:"winWall", x:250, y:240, width:15, height:100, rotation:0},
		{type:"failWall", x:0, y:600, width:1300, height:1, rotation:0}
		];

		bikegame.levels[1]=[
		{type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0, fuel:30},
		{type:"ground", x:250, y:270, width:250, height:25, rotation:0},
		{type:"winWall", x:300, y:240, width:15, height:100, rotation:0}
		];

		bikegame.levels[2]=[
		    {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0,fuel:30},
		    {type:"ground", x:250, y:270, width:250, height:25, rotation:0},
		    {type:"winWall", x:300,y:240, width:15, height:100, rotation:0}
		];
		bikegame.levels[3]=[
		    {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0,fuel:30},
		    {type:"ground", x:250, y:270, width:250, height:25, rotation:0},
		    {type:"winWall", x:300, y:240, width:15, height:100, rotation:0}
		];
		bikegame.levels[4]=[
		    {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0,fuel:30},
		    {type:"ground", x:250, y:270, width:250, height:25, rotation:0},
		    {type:"winWall", x:300,y:240, width:15, height:100, rotation:0}
		];


  function testSetObject1(){
	  bikegame.world = createWorld();
	  var obj = {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0,fuel:30};
	  var bike = createBikeAt(bikegame.world, 50, 210);
	  setObject(obj);
	  assertNotEquals("Successfully set a bike in the world, otherwise, assert.", bike, bikegame.bike);
  }
  
  function testSetObject2(){
	  var obj = {type:"ground", x:250, y:270, width:250, height:25, rotation:0};
	  setObject(obj);
  }
  
  function testSetObject3(){
	  var obj = {type:"winWall", x:300,y:240, width:15, height:100, rotation:0};
	  var gameWinWall = createGround(300, 240, 15, 100, 0, "winWall");
	  setObject(obj);
	  assertNotEquals("Successfully set a winWall in the world, otherwise, assert.", gameWinWall, bikegame.gameWinWall);
  }
  
  function testSetObject4(){
	  var obj = {type:"failWall", x:0, y:600, width:1300, height:1, rotation:0};
	  var gameFailWall = createGround(0, 600, 1300, 1, 0, "failWall");
	  setObject(obj);
	  assertNotEquals("Successfully set a failWall in the world, otherwise, assert.", gameFailWall, bikegame.gameFailWall);
  }
  
  function testCalculateScore(){
	  bikegame.levelScoreBase = 2000;
	  bikegame.timeCount = 56;
	  calculateScore();
	  assertNotEquals("bikegame.levelScore for levelScoreBase of 2000, and timeCount of 56 is 3001", 3001, bikegame.levelScore);
  }
  
  function testupdateLevelInfo1(){
	  bikegame.currentLevel = 1;
	  bikegame.compeltedLevel = 2;
	  bikegame.statelLevelResult = 3;
	  updateLevelInfo();
	  assertEquals("change the currentState of the bikegame", bikegame.currentState, bikegame.statelLevelResult);
  }
  
  function testupdateLevelInfo2(){
	  bikegame.currentLevel = 2;
	  bikegame.compeltedLevel = 1;
	  bikegame.statelLevelResult = 3;
	  updateLevelInfo();
	  assertEquals("change the compeltedLevel", 2, bikegame.compeltedLevel);
	  assertEquals("change the currentState of the bikegame", 3, bikegame.currentState);
  }
  
  function testRestartGame(){
	  restartGame(0);
	  assertEquals("reset levelScore to 0", bikegame.levelScore, 0);
	  assertEquals("reset tiemCount to 0", bikegame.timeCount, 0);
	  assertNotNull("creat a world of bikegame", bikegame.world);
	  
  }
  
  function testCheckWin(){
	  bikegame.currentLevel = 2;
	  bikegame.completedLevel = 2;
	  bikegame.statelLevelResult = 2;
	  bikegame.bike = {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0, fuel:30};
	  bikegame.gameWinWall = {type:"winWall", x:300,y:240, width:15, height:100, rotation:0};
	  bikegame.numberOfLevels = 1;
	  var body1 = bikegame.bike;
	  var body2 = bikegame.gameWinWall;
	  
	  checkWin(body1, body2);
	  assertNotNull("game over", bikegame.world);
  }

 function testCheckFall(){
	 bikegame.currentLevel = 2;
	 bikegame.bike = {type:"bike", x:50, y:210, currentSpeed:0, timeCount: 0, fuel:30};
	 bikegame.gameFailWall = {type:"failWall", x:300,y:240, width:15, height:100, rotation:0};
	 var body1 = bikegame.bike;
	 var body2 = bikegame.gameFailWall;
	 checkFall();
	 assertNotNull("bike failed, restart the game", bikegame.world);
	 
 }
 
  </script>
  </head>
  </html>
  